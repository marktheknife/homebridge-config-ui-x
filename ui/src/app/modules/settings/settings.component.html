<h3 class="primary-text m-0">{{ 'menu.settings.title' | translate }}</h3>

<!-- GENERAL SETTINGS - ALL USERS -->
<div class="my-4">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.general ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsGeneral'"
    (click)="toggleSection('general')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.general ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.general.title_general' | translate }}
    </h5>
  </div>
  @if (showFields.general) {
  <ul class="list-group list-group-box mt-2 mx-0" id="fieldsGeneral">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2"> {{ 'menu.label_settings_advanced' | translate }} </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="openUiSettings()"
        [attr.aria-label]="'menu.label_settings_advanced' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2"> {{ 'backup.title_backup' | translate }} </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="openBackupModal()"
        [attr.aria-label]="'backup.title_backup' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2"> {{ 'menu.tooltip_user_accounts' | translate }} </span>
      <a
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        routerLink="/users"
        [attr.aria-label]="'menu.tooltip_user_accounts' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </a>
    </li>
  </ul>
  }
</div>

<!-- DISPLAY SETTINGS - ALL USERS -->
<div class="my-4">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.display ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsDisplay'"
    (click)="toggleSection('display')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.display ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.general.title_display' | translate }}
    </h5>
  </div>
  @if (showFields.display) {
  <ul class="list-group list-group-box mt-2 mx-0" id="fieldsDisplay">
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      {{ 'settings.display.lang' | translate }}
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [ngModel]="$settings.env.lang"
          (ngModelChange)="saveUiSettingChange('lang', $event)"
        >
          <option value="auto">{{ 'form.select.auto' | translate }}</option>
          <option value="bg">Bulgarian (bg)</option>
          <option value="ca">Catalan (ca)</option>
          <option value="zh-CN">Chinese - Simplified (zh-CN)</option>
          <option value="zh-TW">Chinese - Traditional (zh-TW)</option>
          <option value="cs">Czech (cs)</option>
          <option value="nl">Dutch (nl)</option>
          <option value="en">English (en)</option>
          <option value="fi">Finnish (fi)</option>
          <option value="fr">French (fr)</option>
          <option value="de">German (de)</option>
          <option value="he">Hebrew (he)</option>
          <option value="hu">Hungarian (hu)</option>
          <option value="id">Indonesian (id)</option>
          <option value="it">Italian (it)</option>
          <option value="ja">Japanese (ja)</option>
          <option value="ko">Korean (ko)</option>
          <option value="mk">Macedonian (mk)</option>
          <option value="no">Norwegian (no)</option>
          <option value="pl">Polish (pl)</option>
          <option value="pt-BR">Portuguese (Brazil)</option>
          <option value="pt">Portuguese (Portugal)</option>
          <option value="ru">Russian (ru)</option>
          <option value="sl">Slovenian (sl)</option>
          <option value="es">Spanish (es)</option>
          <option value="sv">Swedish (sv)</option>
          <option value="th">Thai (th)</option>
          <option value="tr">Turkish (tr)</option>
          <option value="uk">Ukrainian (uk)</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      {{ 'settings.display.theme' | translate }}
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [ngModel]="$settings.theme"
          (ngModelChange)="saveUiSettingChange('theme', $event)"
        >
          <option value="orange">{{ 'settings.display.orange' | translate }}</option>
          <option value="red">{{ 'settings.display.red' | translate }}</option>
          <option value="pink">{{ 'settings.display.pink' | translate }}</option>
          <option value="purple">{{ 'settings.display.purple' | translate }}</option>
          <option value="deep-purple">{{ 'settings.display.deep_purple' | translate }}</option>
          <option value="indigo">{{ 'settings.display.indigo' | translate }}</option>
          <option value="blue">{{ 'settings.display.blue' | translate }}</option>
          <option value="blue-grey">{{ 'settings.display.bluegrey' | translate }}</option>
          <option value="cyan">{{ 'settings.display.cyan' | translate }}</option>
          <option value="green">{{ 'settings.display.green' | translate }}</option>
          <option value="teal">{{ 'settings.display.teal' | translate }}</option>
          <option value="grey">{{ 'settings.display.grey' | translate }}</option>
          <option value="brown">{{ 'settings.display.brown' | translate }}</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      {{ 'settings.display.lighting_mode' | translate }}
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [ngModel]="$settings.lightingMode"
          (ngModelChange)="saveUiSettingChange('lightingMode', $event)"
        >
          <option value="auto">{{ 'form.select.auto' | translate }}</option>
          <option value="light">{{ 'settings.display.light' | translate }}</option>
          <option value="dark">{{ 'settings.display.dark' | translate }}</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      {{ 'settings.display.menu_mode' | translate }}
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [ngModel]="$settings.menuMode"
          (ngModelChange)="saveUiSettingChange('menuMode', $event)"
        >
          <option value="default">{{ 'settings.display.menu_default' | translate }}</option>
          <option value="freeze">{{ 'settings.display.menu_freeze' | translate }}</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.display.login_wallpaper' | translate }}<br />
        <small
          class="grey-text pr-2"
          [innerHTML]="'settings.display.login_wallpaper_desc' | translate: { file }"
        ></small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <!-- 'search' in the name prevents safari showing the credentials prompt -->
        <input
          name="search_wallpaper"
          autocomplete="off"
          class="form-control custom-input form-control-sm resp-input"
          type="text"
          [ngModel]="$settings.loginWallpaper"
          (ngModelChange)="saveUiSettingChange('loginWallpaper', $event)"
          placeholder="/path-to/image.png"
        />
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      {{ 'settings.display.temp_units' | translate }}
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [ngModel]="$settings.env.temperatureUnits"
          (ngModelChange)="saveUiSettingChange('tempUnits', $event)"
        >
          <option value="c">{{ 'settings.display.temp_units.c' | translate }}</option>
          <option value="f">{{ 'settings.display.temp_units.f' | translate }}</option>
        </select>
      </div>
    </li>
    @if (hasChangedLoginWallpaper) {
    <li class="list-group-item d-flex flex-column align-items-center">
      <small class="grey-text my-2">{{ 'settings.changes.saved' | translate }}</small>
      <button
        class="btn btn-primary waves-effect my-2"
        routerLink="/restart"
        [attr.aria-label]="'menu.tooltip_restart' | translate"
      >
        {{ 'menu.tooltip_restart' | translate }}
      </button>
    </li>
    }
  </ul>
  }
</div>

<!-- STARTUP/ENV OPTIONS - SERVICE MODE/DOCKER USERS -->
@if ($settings.env.serviceMode || $settings.env.runningInDocker) {
<form class="my-4" novalidate [formGroup]="serviceForm">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.startup ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsStartup'"
    (click)="toggleSection('startup')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.startup ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.title_startup_options' | translate }}
    </h5>
  </div>
  @if (showFields.startup) {
  <ul class="list-group list-group-box mb-4 mx-0" id="fieldsStartup">
    @if ($settings.env.serviceMode) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.startup.debug' | translate }} <code>-D</code><br />
        <small class="grey-text pr-2">
          {{ (isHbV2 ? 'settings.startup.debug_desc_v2' : 'settings.startup.debug_desc_v1') | translate }}
        </small>
      </span>
      <input
        type="checkbox"
        class="rendux-input"
        id="homebridgeDebugMode"
        formControlName="HOMEBRIDGE_DEBUG"
        [attr.aria-label]="'settings.startup.debug' | translate"
      />
      <label for="homebridgeDebugMode" class="rendux-label ml-3" style="min-width: 50px"></label>
    </li>
    } @if ($settings.env.serviceMode) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.startup.insecure' | translate }} <code>-I</code><br />
        <small class="grey-text pr-2">{{ 'settings.startup.insecure_desc' | translate }}</small>
      </span>
      <input
        type="checkbox"
        class="rendux-input"
        id="homebridgeInsecureMode"
        formControlName="HOMEBRIDGE_INSECURE"
        [attr.aria-label]="'settings.startup.insecure' | translate"
      />
      <label for="homebridgeInsecureMode" class="rendux-label ml-3" style="min-width: 50px"></label>
    </li>
    } @if ($settings.env.serviceMode) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.startup.keep_accessories' | translate }} <code>-K</code><br />
        <small class="grey-text pr-2">{{ 'settings.startup.keep_accessories_desc' | translate }}</small>
      </span>
      <input
        type="checkbox"
        class="rendux-input"
        id="homebridgeKeepOrphans"
        formControlName="HOMEBRIDGE_KEEP_ORPHANS"
        [attr.aria-label]="'settings.startup.keep_accessories' | translate"
      />
      <label for="homebridgeKeepOrphans" class="rendux-label ml-3" style="min-width: 50px"></label>
    </li>
    } @if ($settings.env.serviceMode) {
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        <span class="text-monospace">DEBUG</span><br />
        <small
          class="grey-text pr-2"
          [innerHTML]="'settings.service.debug_tooltip' | translate: { link: linkDebug }"
        ></small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <input
          class="form-control custom-input form-control-sm resp-input"
          formControlName="ENV_DEBUG"
          type="text"
          placeholder="HAP-NodeJS:Advertiser,HAP-NodeJS:Service"
        />
      </div>
    </li>
    } @if ($settings.env.serviceMode) {
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        <span class="text-monospace">NODE_OPTIONS</span><br />
        <small class="grey-text pr-2">{{ 'settings.service.node_tooltip' | translate }}</small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <input
          class="form-control custom-input form-control-sm resp-input"
          formControlName="ENV_NODE_OPTIONS"
          type="text"
          placeholder="--max-old-space-size=512 --max-http-header-size=8192"
        />
      </div>
    </li>
    } @if ($settings.env.runningInDocker) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>
        {{ 'menu.docker.startup_script' | translate }}<br />
        <small class="grey-text pr-2">{{ 'platform.docker.script_help' | translate }}</small>
      </span>
      <a
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        routerLink="/platform-tools/docker/startup-script"
        [attr.aria-label]="'menu.docker.startup_script' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </a>
    </li>
    } @if (hasChangedService) {
    <li class="list-group-item d-flex flex-column align-items-center">
      <small class="grey-text my-2">{{ 'settings.changes.saved' | translate }}</small>
      <button
        class="btn btn-primary waves-effect my-2"
        routerLink="/restart"
        [attr.aria-label]="'menu.tooltip_restart' | translate"
      >
        {{ 'menu.tooltip_restart' | translate }}
      </button>
    </li>
    }
  </ul>
  }
</form>
}

<!-- NETWORK SETTINGS - ALL USERS -->
<form class="my-4" novalidate [formGroup]="uiSettingsForm">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.network ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsNetwork'"
    (click)="toggleSection('network')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.network ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.network.title_network' | translate }}
    </h5>
  </div>
  @if (showFields.network) {
  <ul class="list-group list-group-box mt-2 mx-0" id="fieldsNetwork">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'settings.network.title_network_interfaces' | translate }}<br />
        <small class="grey-text pr-2">{{ 'settings.network.message_network_interface' | translate }}</small>
        @for (adapter of bridgeNetworkAdapters; track adapter) {
        <span>
          <span
            class="badge badge-pill mr-1"
            [ngClass]="{ 'badge-danger': adapter.missing, 'badge-info': !adapter.missing }"
          >
            @if (adapter.missing) {
            <i class="fas fa-fw fa-exclamation-triangle"></i>
            } {{ adapter.iface }}:
            <span class="font-weight-normal"
              >{{ adapter.missing ? ('settings.mdns_advertiser_not_connected' | translate) : adapter.ip4 || adapter.ip6
              }}</span
            >
          </span>
        </span>
        }
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="selectNetworkInterfaces()"
        [disabled]="!availableNetworkAdapters.length"
        [attr.aria-label]="'settings.network.title_network_interfaces' | translate"
      >
        <i class="fas fa-fw fa-arrow-right" [ngClass]="{ 'fa-pulse': !availableNetworkAdapters.length }"></i>
      </button>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.mdns_advertiser' | translate }}<br />
        <small class="grey-text pr-2">{{ 'settings.mdns_advertiser_help' | translate }}</small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select
          class="custom-select resp-select"
          [formControl]="legacyMdnsFormControl"
          [attr.aria-label]="'settings.mdns_advertiser' | translate"
        >
          @if (showAvahiMdnsOption) {
          <option value="avahi">Avahi ({{ 'settings.mdns_advertiser_rec' | translate }})</option>
          }
          <!-- ciao is recommended if avahi is not available -->
          <option value="ciao">
            Ciao {{ showAvahiMdnsOption ? '' : '(' + ('settings.mdns_advertiser_rec' | translate) + ')' }}
          </option>
          <option value="bonjour-hap">Bonjour HAP</option>
          @if (showResolvedMdnsOption) {
          <option value="resolved">systemd-resolved ({{ 'settings.mdns_advertiser_exp' | translate }})</option>
          }
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.network.port_hb' | translate }}<br />
        <small class="grey-text pr-2">{{ 'settings.network.port_hb_desc' | translate }}</small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <input
          class="form-control custom-input form-control-sm resp-input"
          type="number"
          min="1025"
          max="65533"
          [formControl]="hbPortFormControl"
          [attr.aria-label]="('settings.network.port_ui' | translate)"
          [ngClass]="{ 'is-invalid': isInvalidHbPort }"
        />
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.network.port_ui' | translate }}<br />
        <small class="grey-text pr-2">{{ 'settings.network.port_ui_desc' | translate }}</small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <input
          class="form-control custom-input form-control-sm resp-input"
          type="number"
          min="1025"
          max="65533"
          placeholder="8581"
          formControlName="port"
          [attr.aria-label]="('settings.network.port_ui' | translate)"
          [ngClass]="{ 'is-invalid': isInvalidHbUiPort }"
        />
      </div>
    </li>
    @if (hasChangedHbPort || hasChangedUiSettings || hasChangedMdns || hasChangedBridgeNetworkAdapters) {
    <li class="list-group-item d-flex flex-column align-items-center">
      <small class="grey-text my-2">{{ 'settings.changes.saved' | translate }}</small>
      <button
        class="btn btn-primary waves-effect my-2"
        routerLink="/restart"
        [attr.aria-label]="'menu.tooltip_restart' | translate"
      >
        {{ 'menu.tooltip_restart' | translate }}
      </button>
    </li>
    }
  </ul>
  }
</form>

<!-- CACHE SETTINGS - SERVICE MODE USERS ONLY -->
@if ($settings.env.serviceMode) {
<div class="my-4">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.cache ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsCache'"
    (click)="toggleSection('cache')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.cache ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.cache.title' | translate }}
    </h5>
  </div>
  @if (showFields.cache) {
  <p class="small grey-text mb-2 mx-0">{{ 'settings.cache.desc' | translate }}</p>
  } @if (showFields.cache) {
  <ul class="list-group list-group-box mb-4 mx-0" id="fieldsCache">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.accessory_ind.title' | translate }}<br />
        <small class="grey-text pr-2">{{ 'reset.accessory_ind.desc' | translate }}</small>
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="removeSingleCachedAccessories()"
        [attr.aria-label]="'reset.accessory_ind.title' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.bridge_accessories.title' | translate }}<br />
        <small class="grey-text pr-2">{{ 'reset.bridge_accessories.desc' | translate }}</small>
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="removeBridgeAccessories()"
        [attr.aria-label]="'reset.accessory_all.title' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.accessory_all.title' | translate }}<br />
        <small class="grey-text pr-2">{{ 'reset.accessory_all.desc' | translate }}</small>
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="removeAllCachedAccessories()"
        [attr.aria-label]="'reset.accessory_all.title' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
  </ul>
  }
</div>
}

<!-- RESET SETTINGS - ALL USERS -->
<div class="my-4">
  <div
    role="button"
    tabindex="0"
    [attr.aria-expanded]="showFields.reset ? 'true' : 'false'"
    [attr.aria-controls]="'fieldsReset'"
    (click)="toggleSection('reset')"
    class="mt-3 hover-pointer"
  >
    <h5 class="primary-text">
      <i class="fa fa-fw" [ngClass]="showFields.reset ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'reset.bridges.title' | translate }}
    </h5>
  </div>
  @if (showFields.reset) {
  <p class="small grey-text mb-2 mx-0">{{ 'reset.bridges.desc' | translate }}</p>
  } @if (showFields.reset) {
  <ul class="list-group list-group-box mt-2 mx-0" id="fieldsReset">
    @if ($settings.env.serviceMode) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.bridge_ind.title' | translate }}<br />
        <small class="grey-text pr-2">{{ 'reset.bridge_ind.desc' | translate }}</small>
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="unpairAccessory()"
        [attr.aria-label]="'reset.bridge_ind.title' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
    }
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.bridge_all.title' | translate | titlecase }}<br />
        <small class="grey-text pr-2">{{ 'reset.bridge_all.desc' | translate }}</small>
      </span>
      <button
        class="btn btn-primary waves-effect m-0 ml-3"
        style="min-width: 50px"
        (click)="resetHomebridgeState()"
        [attr.aria-label]="'reset.bridge_all.title' | translate"
      >
        <i class="fas fa-fw fa-arrow-right"></i>
      </button>
    </li>
  </ul>
  }
</div>
<div class="pb-3"></div>
